<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveList - Database Manager</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const Plus = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Edit2 = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>;
        const Trash2 = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const Search = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>;
        const Download = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const X = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const Check = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;

        // Simple storage polyfill for local development
        if (typeof window.storage === 'undefined') {
            const localDB = {};
            window.storage = {
                async get(key) {
                    const value = localStorage.getItem(key);
                    return value ? { key, value, shared: false } : null;
                },
                async set(key, value) {
                    localStorage.setItem(key, value);
                    return { key, value, shared: false };
                },
                async delete(key) {
                    localStorage.removeItem(key);
                    return { key, deleted: true, shared: false };
                },
                async list(prefix) {
                    const keys = Object.keys(localStorage).filter(k => !prefix || k.startsWith(prefix));
                    return { keys, prefix, shared: false };
                }
            };
        }

        function DatabaseManager() {
            const [records, setRecords] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [isAdding, setIsAdding] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                phone: '',
                company: '',
                notes: ''
            });

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    const result = await window.storage.list('record:');
                    if (result && result.keys) {
                        const loadedRecords = await Promise.all(
                            result.keys.map(async (key) => {
                                try {
                                    const item = await window.storage.get(key);
                                    return item ? JSON.parse(item.value) : null;
                                } catch {
                                    return null;
                                }
                            })
                        );
                        setRecords(loadedRecords.filter(r => r !== null));
                    }
                } catch (error) {
                    console.log('No existing data found, starting fresh');
                }
            };

            const saveRecord = async () => {
                if (!formData.name.trim()) {
                    alert('Name is required');
                    return;
                }

                const record = {
                    ...formData,
                    id: editingId || Date.now().toString(),
                    timestamp: new Date().toISOString()
                };

                try {
                    await window.storage.set(`record:${record.id}`, JSON.stringify(record));
                    await loadData();
                    resetForm();
                } catch (error) {
                    alert('Failed to save record');
                }
            };

            const deleteRecord = async (id) => {
                if (!confirm('Are you sure you want to delete this record?')) return;
                
                try {
                    await window.storage.delete(`record:${id}`);
                    await loadData();
                } catch (error) {
                    alert('Failed to delete record');
                }
            };

            const startEdit = (record) => {
                setFormData(record);
                setEditingId(record.id);
                setIsAdding(true);
            };

            const resetForm = () => {
                setFormData({ name: '', email: '', phone: '', company: '', notes: '' });
                setIsAdding(false);
                setEditingId(null);
            };

            const exportData = () => {
                const csv = [
                    ['Name', 'Email', 'Phone', 'Company', 'Notes', 'Date Added'],
                    ...records.map(r => [
                        r.name,
                        r.email,
                        r.phone,
                        r.company,
                        r.notes,
                        new Date(r.timestamp).toLocaleDateString()
                    ])
                ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'database_export.csv';
                a.click();
            };

            const filteredRecords = records.filter(record =>
                Object.values(record).some(val =>
                    String(val).toLowerCase().includes(searchTerm.toLowerCase())
                )
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 mb-4">My Learning App</h1>
                            
                            <div className="flex gap-3 flex-wrap">
                                <div className="flex-1 min-w-[200px] relative">
                                    <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <Search />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Search records..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                </div>
                                <button
                                    onClick={() => setIsAdding(true)}
                                    className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors"
                                >
                                    <Plus /> Add Record
                                </button>
                                <button
                                    onClick={exportData}
                                    disabled={records.length === 0}
                                    className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2 transition-colors disabled:bg-gray-400"
                                >
                                    <Download /> Export CSV
                                </button>
                            </div>
                        </div>

                        {isAdding && (
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold text-gray-800">
                                        {editingId ? 'Edit Record' : 'Add New Record'}
                                    </h2>
                                    <button onClick={resetForm} className="text-gray-500 hover:text-gray-700">
                                        <X />
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input
                                        type="text"
                                        placeholder="Name *"
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                    <input
                                        type="email"
                                        placeholder="Email"
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                    <input
                                        type="tel"
                                        placeholder="Phone"
                                        value={formData.phone}
                                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Company"
                                        value={formData.company}
                                        onChange={(e) => setFormData({...formData, company: e.target.value})}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                    <textarea
                                        placeholder="Notes"
                                        value={formData.notes}
                                        onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent md:col-span-2"
                                        rows="3"
                                    />
                                </div>
                                
                                <button
                                    onClick={saveRecord}
                                    className="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors"
                                >
                                    <Check /> {editingId ? 'Update' : 'Save'} Record
                                </button>
                            </div>
                        )}

                        <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                            {filteredRecords.length === 0 ? (
                                <div className="p-12 text-center text-gray-500">
                                    <p className="text-lg">No records found</p>
                                    <p className="text-sm mt-2">Add your first record to get started</p>
                                </div>
                            ) : (
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50 border-b border-gray-200">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                                                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {filteredRecords.map((record) => (
                                                <tr key={record.id} className="hover:bg-gray-50 transition-colors">
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{record.name}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{record.email}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{record.phone}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{record.company}</td>
                                                    <td className="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">{record.notes}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                        <button
                                                            onClick={() => startEdit(record)}
                                                            className="text-blue-600 hover:text-blue-900 mr-3 transition-colors"
                                                        >
                                                            <Edit2 />
                                                        </button>
                                                        <button
                                                            onClick={() => deleteRecord(record.id)}
                                                            className="text-red-600 hover:text-red-900 transition-colors"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </div>

                        <div className="mt-4 text-center text-sm text-gray-600">
                            Total Records: {records.length} {searchTerm && `(${filteredRecords.length} shown)`}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<DatabaseManager />, document.getElementById('root'));
    </script>
</body>
</html>